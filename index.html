<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Les i Bibelen pÃ¥ nett</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <img src="lesbibele.jpg" alt="Bibelen toppbilde" class="hero-image" />
    <h1>Les i Bibelen pÃ¥ nett</h1>
  </header>

  <main>
    <div class="controls">
      <label for="translation">Velg sprÃ¥k eller oversettelse:</label><br />
      <select id="translation">
        <optgroup label="Engelske oversettelser">
          <option value="web">ğŸ‡¬ğŸ‡§ World English Bible (WEB)</option>
          <option value="kjv">ğŸ‡¬ğŸ‡§ King James Version (KJV)</option>
          <option value="bbe">ğŸ‡¬ğŸ‡§ Bible in Basic English (BBE)</option>
          <option value="ylt">ğŸ‡¬ğŸ‡§ Youngâ€™s Literal Translation (YLT)</option>
          <option value="asv">ğŸ‡ºğŸ‡¸ American Standard Version (ASV)</option>
        </optgroup>
        <optgroup label="Skandinaviske sprÃ¥k">
          <option value="nob">ğŸ‡³ğŸ‡´ Norsk (BokmÃ¥l â€“ Bibel 2011)</option>
          <option value="swe">ğŸ‡¸ğŸ‡ª Svenska</option>
          <option value="dan">ğŸ‡©ğŸ‡° Dansk</option>
        </optgroup>
      </select>

      <br /><br />

      <label for="verse">Skriv inn bibelsted (f.eks. John 3:16 eller Salme 23:1):</label><br />
      <input type="text" id="verse" placeholder="Skriv inn her..." />
      <button id="getVerse">Hent vers</button>

      <p class="info">
        â„¹ï¸ Appen bruker Ã¥pne bibel-API-er. Dersom et vers ikke finnes pÃ¥ valgt sprÃ¥k,
        vises det automatisk pÃ¥ engelsk som reserve.
      </p>
    </div>

    <div id="result"></div>
  </main>

  <footer>
    <p>Â© 2025 BibelApp â€“ Gratis bibellesning pÃ¥ flere sprÃ¥k</p>
  </footer>

  <script>
    document.getElementById("getVerse").addEventListener("click", async () => {
      const verseInput = document.getElementById("verse").value.trim();
      const translation = document.getElementById("translation").value;
      const result = document.getElementById("result");

      if (!verseInput) {
        result.innerHTML = "<p>âš ï¸ Skriv inn et bibelsted fÃ¸rst.</p>";
        return;
      }

      result.innerHTML = "â³ Henter vers...";

      let dataText = "";
      let dataRef = "";
      let source = "";

      try {
        // 1ï¸âƒ£ Bolls.life for svensk, dansk og (noe) norsk
        if (["nob", "swe", "dan"].includes(translation)) {
          const bollsUrl = `https://bolls.life/get-bible?bible=${
            translation === "nob"
              ? "norwegian"
              : translation === "swe"
              ? "swedish"
              : "danish"
          }&passage=${encodeURIComponent(verseInput)}`;
          const bollsRes = await fetch(bollsUrl);
          const bollsData = await bollsRes.json();
          if (bollsData.text) {
            dataText = bollsData.text;
            dataRef = verseInput;
            source = "Skandinavisk (Bolls.life)";
          }
        }

        // 2ï¸âƒ£ API.Bible via Netlify proxy for norsk Bibel 2011
        if (!dataText && translation === "nob") {
          const apiBibleKey = "51658bcd81eabe502071d3f9b2d28780"; // din nÃ¸kkel
          const bibleId = "06125adad2d5898a-01"; // Bibelen 2011 BokmÃ¥l
          const apiUrl = `/api/bibles/${bibleId}/search?query=${encodeURIComponent(
            verseInput
          )}`;
          const apiRes = await fetch(apiUrl, {
            headers: { "api-key": apiBibleKey },
          });
          const apiData = await apiRes.json();

          if (
            apiData.data &&
            apiData.data.passages &&
            apiData.data.passages.length > 0
          ) {
            dataText = apiData.data.passages[0].content;
            dataRef = apiData.data.passages[0].reference;
            source = "Norsk (API.Bible â€“ Bibel 2011)";
          }
        }

        // 3ï¸âƒ£ Bible-API fallback (engelsk)
        if (!dataText) {
          const bibleApiUrl = `https://bible-api.com/${encodeURIComponent(
            verseInput
          )}?translation=${translation}`;
          const bibleRes = await fetch(bibleApiUrl);
          const bibleData = await bibleRes.json();
          if (bibleData.text) {
            dataText = bibleData.text.replace(/\n/g, "<br>");
            dataRef = bibleData.reference;
            source = "English (fallback)";
          }
        }

        // 4ï¸âƒ£ Vis resultat
        if (dataText) {
          result.innerHTML = `<h3>${dataRef}</h3><p>${dataText}</p><small><i>${source}</i></small>`;
        } else {
          result.innerHTML =
            "<p>âš ï¸ Fant ikke verset pÃ¥ valgt sprÃ¥k. PrÃ¸v et annet.</p>";
        }
      } catch (err) {
        result.innerHTML = `<p>ğŸš¨ Feil: ${err.message}</p><p>Hvis du kjÃ¸rer denne siden lokalt, mÃ¥ du bruke Netlify-proxy (se netlify.toml).</p>`;
      }
    });
  </script>
</body>
</html>
